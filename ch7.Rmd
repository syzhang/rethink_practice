---
title: "Rethink chapter 7 practice"
output: html_notebook
---

Problem 7H3

3 islands, each have different proportions of 5 birb species.

a) Compute the entropy of each island's birb distribution
```{r}
H <- function(p) -sum(p*log(p))

IB <- list()
IB[[1]] <- c( 0.2 , 0.2 , 0.2 , 0.2 , 0.2 )
IB[[2]] <- c( 0.8 , 0.1 , 0.05 , 0.025 , 0.025 )
IB[[3]] <- c( 0.05 , 0.15 , 0.7 , 0.05 , 0.05 )
sapply( IB , H )
```
Island 1 has highest entropy, there's more uncertainty inherent in the distribution (not sure which species of bird you'll observe, wouldn't be very surprised to observe any species). Island 2 has lowest entropy, the opposite.

b) use each island's birb distribution to predict the other 2. Compute KL Divergence of each island from others.
```{r}
DKL <- function(p,q) sum( p*(log(p)-log(q)) )

Dm <- matrix( NA , nrow=3 , ncol=3 )
for ( i in 1:3 ) for ( j in 1:3 ) Dm[i,j] <- DKL( IB[[i]] , IB[[j]] )
round( Dm , 2 )
```
```{r}
colMeans(Dm)
```

p is the true value, q is the model value. Column 1 uses island 1 as a model for other islands, and it has the lowest KL divergence comparing to others. Island 1 has highest entropy and shortest KL divergences, because it's least surprised at whichever bird observation.




7H4

Marriage, age, happeniss collider bias example from Chapter 6. 

```{r}
library(rethinking)
d <- sim_happiness( seed=1977 , N_years=1000 ) 
precis(d)
```
```{r}
d2 <- d[ d$age>17 , ] # only adults 
d2$A <- ( d2$age - 18 ) / ( 65 - 18 )
```

```{r}
d2$mid <- d2$married + 1 
m6.9 <- quap(
  alist(
  happiness ~ dnorm( mu , sigma ),
  mu <- a[mid] + bA*A, 
  a[mid] ~ dnorm( 0 , 1 ), 
  bA ~ dnorm( 0 , 2 ), 
  sigma ~ dexp(1)
) , data=d2 ) 
precis(m6.9,depth=2)
```
Age is negatively associated with happiness in m6.9. (collider bias, conditioning on marriage introduce correlation)

```{r}
m6.10 <- quap( alist(
  happiness ~ dnorm( mu , sigma ), 
  mu <- a + bA*A,
  a ~ dnorm( 0 , 1 ),
  bA ~ dnorm( 0 , 2 ),
  sigma ~ dexp(1) ) , data=d2 )
precis(m6.10)
```

m6.10 there's no association between age and happinness.

Compare WAIC of the two models
```{r}
compare( m6.9, m6.10 )
```
```{r}
compare( m6.9, m6.10, func=PSIS)
```

Collider biased model 6.9 actually produces better predictions. => We'll end up mistaken about the causal inference if choosing models based on WAIC.


