---
title: "Rethink chapter 9 practice"
output: html_notebook
---

9H3

Leg length example:
100 individuals, left and right leg lengths, and heights, simulated from a Gaussian. Multicollinear problem (strong correlation between two or more predictor variables).

```{r}
N <- 100
set.seed(909)
height <- rnorm(N,10,2) 
leg_prop <- runif(N,0.4,0.5) 
leg_left <- leg_prop*height + rnorm( N , 0 , 0.02 ) 
leg_right <- leg_prop*height + rnorm( N , 0 , 0.02 )
d <- data.frame(height,leg_left,leg_right)
```

```{r}
plot(leg_left, leg_right)
```
```{r}
plot(leg_left, height)
```
```{r}
plot(leg_right, height)
```

Using quap
```{r}
m6.1 <- quap( alist(
height ~ dnorm( mu , sigma ) ,
mu <- a + bl*leg_left + br*leg_right , a ~ dnorm( 10 , 100 ) ,
bl ~ dnorm( 2 , 10 ) ,
br ~ dnorm( 2 , 10 ) ,
sigma ~ dexp( 1 )
) , data=d ) 
precis(m6.1)
```
```{r}
coeftab_plot( coeftab(m6.1))
```

Using ulam

```{r}
m5.8s <- ulam( alist(
height ~ dnorm( mu , sigma ) ,
mu <- a + bl*leg_left + br*leg_right , a ~ dnorm( 10 , 100 ) ,
bl ~ dnorm( 2 , 10 ) ,
br ~ dnorm( 2 , 10 ) ,
sigma ~ dexp( 1 )
) , data=d, chains=4, start=list(a=10,bl=0,br=0.1,sigma=1) , log_lik = TRUE)
```
Alternative model that forces parameter br to be strictly positive

```{r}
m5.8s2 <- ulam( alist(
height ~ dnorm( mu , sigma ) ,
mu <- a + bl*leg_left + br*leg_right , a ~ dnorm( 10 , 100 ) ,
bl ~ dnorm( 2 , 10 ) ,
br ~ dnorm( 2 , 10 ) ,
sigma ~ dexp( 1 )
) , data=d, chains=4, constraints=list(br="lower=0"), start=list(a=10,bl=0,br=0.1,sigma=1) , log_lik = TRUE)
```

```{r}
pairs( m5.8s )
```

```{r}
pairs( m5.8s2)
```
br strictly positive, forcing bl to be negative. 

```{r}
traceplot( m5.8s)
trankplot( m5.8s)
```
```{r}
traceplot( m5.8s2)
trankplot( m5.8s2)
```

9H4

compute WAIC and PSIS of models above

```{r}
compare( m5.8s, m5.8s2)
```
The penalty term in WAIC (pWAIC) is the effective number of parameters, aka the overfitting penalty. m5.8s2 (restricting br to be positive) has a lower effective number, since the restricted range lowers the risk of overfitting.

```{r}
precis( m5.8s )
```

```{r}
precis( m5.8s2 )
```

